{% load staticfiles %}

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>dataRonin</title>
<meta name="keywords" content="" />
<meta name="description" content="" />
<script src="{% static 'visual/js/jquery.js' %}"></script>
<script src="{% static 'visual/js/jquery.flot.js' %}"></script>
<script src="{% static 'visual/js/jquery.flot.axislabels.js' %}"></script>
<script>
$(function() {
	var timeSeries = [];
	
	{% for year, value in time_series %}
		timeSeries.push([{{ year }}, {{ value }}]);
	{% endfor %}
		
	var plot = $.plot("#time_series_placeholder", [
			{ data: timeSeries, label: "{{ dataset }}", color: "green"}
		], {
			series: {
				lines: {
					show: true
				},
				points: {
					show: true
				}
			},
			grid: {
				hoverable: true,
				clickable: true
			},
			xaxis: {
				axisLabel: 'Year',
				axisLabelUseCanvas: false
			},
			yaxis: {
				axisLabel: 'Value',
				axisLabelUseCanvas: true
			}
		});
		
	function showTooltip(x, y, contents) {
		$("<div id='tooltip'>" + contents + "</div>").css({
			position: "absolute",
			display: "none",
			top: y - 25,
			left: x + 5,
			border: "1px solid #ccc",
			padding: "2px",
			"background-color": "#fff",
			color: "#000",
			opacity: 0.80
		}).appendTo("body").fadeIn(200);
	}

	var previousPoint = null;
	$("#time_series_placeholder").bind("plothover", function (event, pos, item) {		
		if (item) {
			if (previousPoint != item.dataIndex) {
				previousPoint = item.dataIndex;
				$("#tooltip").remove();
				var x = item.datapoint[0].toFixed(2),
				y = item.datapoint[1].toFixed(2);
				showTooltip(item.pageX, item.pageY,
					item.series.label + " = " + y + " in year " + parseInt(x));
			}
		} else {
			$("#tooltip").remove();
			previousPoint = null;            
		}
	});

	$("#time_series_placeholder").bind("plotclick", function (event, pos, item) {
		if (item) {
			$("#clickdata").text(" - click point " + item.dataIndex + " in " + item.series.label);
			plot.highlight(item.series, item.datapoint);
		}
	});
});

$(function() {
	var histogram = [];
	
	{% for bin, percent in histogram %}
		histogram.push([{{ bin }}, {{ percent }}]);
	{% endfor %}
	
	var plot = $.plot("#histogram_placeholder", [
			{ data: histogram, label: "{{ dataset }}", color: "green"}
		], {
			bars: {
				show: true,
				barWidth: histogram[1][0] - histogram[0][0]
			},
			grid: {
				hoverable: true,
				clickable: true
			},
			xaxis: {
				axisLabel: 'Bin',
				axisLabelUseCanvas: false
			},
			yaxis: {
				axisLabel: 'Percent',
				axisLabelUseCanvas: true
			}
		});
		
	function showTooltip(x, y, contents) {
		$("<div id='tooltip'>" + contents + "</div>").css({
			position: "absolute",
			display: "none",
			top: y - 25,
			left: x + 5,
			border: "1px solid #ccc",
			padding: "2px",
			"background-color": "#fff",
			color: "#000",
			opacity: 0.80
		}).appendTo("body").fadeIn(200);
	}

	var previousPoint = null;
	$("#histogram_placeholder").bind("plothover", function (event, pos, item) {		
		if (item) {
			if (previousPoint != item.dataIndex) {
				previousPoint = item.dataIndex;
				$("#tooltip").remove();
				var x = item.datapoint[0].toFixed(2),
				y = item.datapoint[1].toFixed(2);
				showTooltip(item.pageX, item.pageY,
					y + "% chance of " + item.series.label + " = " + x);
			}
		} else {
			$("#tooltip").remove();
			previousPoint = null;            
		}
	});

	$("#histogram_placeholder").bind("plotclick", function (event, pos, item) {
		if (item) {
			$("#clickdata").text(" - click point " + item.dataIndex + " in " + item.series.label);
			plot.highlight(item.series, item.datapoint);
		}
	});
});
</script>
<!---<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700|Archivo+Narrow:400,700" />--->
<link rel="stylesheet" type="text/css" href="{% static 'visual/style.css' %}" />
</head>
<body>
<div class="wrapper">
	<div id="header-wrapper">
		<div id="header" class="container">
			<div id="logo">
				<h1><a href="index.html"><img src="{% static 'visual/images/dataronin_new.png' %}" alt="dataRonin" /></a></h1>
			</div>	
			<div id="menu">
				<ul>
					<li class="has-sub"><a href="#"><span>Vitae</span></a>
						<ul>
							<li><a href="cv.html"><span>CV</span></a></li>
							<li><a href="publications.html"><span>Publications</span></a></li>
						</ul>
					</li>
					<li class="has-sub"><a href="#"><span>Research</span></a>
						<ul>
							<li><a href="topics.html"><span>Topics</span></a></li>
							<li><a href="instrumentation.html"><span>Instrumentation</span></a></li>
							<li><a href="data.html"><span>Data Analysis</span></a></li>
							<li><a href="field.html"><span>Field Experiences</span></a></li>
							<li><a href="soil.html"><span>Soil Laboratory</span></a></li>
						</ul>
					</li>
					<li class="has-sub"><a href="#">Images</a>
						<ul>
							<li><a href="instruments.html">Instruments</a></li>
							<li><a href="fieldsites.html">Field sites</a></li>
							<li><a href="other.html">Other</a></li>
							<li><a href="video.html">Video</a></li>
						</ul>
					</li>
					<li class="has-sub"><a href="#">Links</a>
						<ul>
							<li><a href="http://andrewsforest.oregonstate.edu">H.J. Andrews</a></li>
							<li><a href="http://www.tinybike.com">Tinybike</a></li>
							<li><a href="http://www.science.oregonstate.edu/~lajthak/">Kate Lajtha</a></li>
						</ul>
					</li>
					<li><a href="about.html">About Fox</a></li>					
				</ul>
			</div>
		</div>
	</div>
	<div id="banner-wrapper"></div>
	<div id="plotter_page" class="container">
		<div id="leftbar">
			<form action="/visual/results/" method="post">
			<ul>
				{% csrf_token %}
				<li>
					Dataset:
					<select name="dataset" id="dataset">
						<option value="bio">bio</option>
						<option value="bio_all">bio_all</option>
						<option value="gro">gro</option>
						<option value="anpp">anpp</option>
						<option value="npp_wet">npp_wet</option>
					</select>
				</li>
				<li><input type="checkbox" value="Yes" name="get_summary" id="get_summary" />Get summary statistics</li>
				<li><input type="checkbox" value="Yes" name="get_histogram" id="get_histogram" />Get histogram</li>
				<li><input type="checkbox" value="Yes" name="get_time_series" id="get_time_series" />Get time series</li>
				<li><input type="submit" value="Fetch" /></li>
			</ul>
			</form>
		</div>
		<div id="plotter">
			{% if get_summary %}
				<p class="announce">Summary statistics</p>
				<ul>
				{% for stat, value in summary %}
					<li>{{ stat }}: {{ value }}</li>
				{% endfor %}
				</ul>
			{% endif %}
			{% if get_time_series %}
				<p class="announce">Time series</p>
				<div class="flot-container">
					<div id="time_series_placeholder" class="flot-placeholder"></div>
				</div>
			{% endif %}
			{% if get_histogram %}
				<p class="announce">Histogram</p>
				<div class="flot-container">
					<div id="histogram_placeholder" class="flot-placeholder"></div>
				</div>
			{% endif %}
		</div>
	</div>
	<div class="push"></div>
</div>
<div id="footer">
	<p>Copyright &copy; 2013 Fox Peterson.  All rights reserved.  Design by <a href="http://www.tinybike.com">Tinybike Interactive</a>.</p>
</div>
</body>
</html>
